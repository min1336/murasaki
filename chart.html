<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>간단한 2D 횡스크롤 게임</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000000;
        }
        canvas {
            display: block;
            margin: 0 auto;
            background-color: #5c94fc;
            border: 1px solid #000000;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="480" height="480"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const player = {
            x: 200,
            y: canvas.height - 50,
            width: 50,
            height: 50,
            color: '#ff0000',
            speed: 5,
            jumpPower: 10,
            isJumping: false,
            jumpHeight: 0,
            canJump: true,
            imageStay: new Image(),
            imageJump: new Image()
        };
        player.imageStay.src = 'https://raw.githubusercontent.com/min1336/murasaki/main/mario_stay.png';
        player.imageJump.src = 'https://raw.githubusercontent.com/min1336/murasaki/main/mario_jump.png';
        player.currentImage = player.imageStay;

        const ground = {
            x: 0,
            y: canvas.height - 40,
            width: canvas.width,
            height: 40,
            color: '#00ff00',
            image: new Image()
        };
        ground.image.src = 'https://raw.githubusercontent.com/min1336/murasaki/main/plane.jpg';

        const box = {
            x: 200,
            y: canvas.height - 150,
            width: 50,
            height: 50,
            image: new Image()
        };
        box.image.src = 'https://raw.githubusercontent.com/min1336/murasaki/main/box.png';

        const coin = {
            x: box.x + box.width / 2,
            y: box.y - 20,
            width: 30,
            height: 30,
            image: new Image(),
            speedY: 2,
            opacity: 1,
            rotation: 0
        };
        coin.image.src = 'https://raw.githubusercontent.com/min1336/murasaki/main/coin.png';

        function controlPlayer() {
            if (player.isJumping) {
                player.y -= player.jumpPower;
                player.jumpHeight += player.jumpPower;
                if (player.jumpHeight >= 100) {
                    player.isJumping = false;
                    player.jumpHeight = 0;
                    player.currentImage = player.imageStay;
                }
            } else {
                if (player.y < ground.y - player.height) {
                    player.y += player.speed;
                } else {
                    player.y = ground.y - player.height;
                    player.canJump = true;
                }
            }
        }

        function drawCoin() {
            ctx.save();
            ctx.translate(coin.x + coin.width / 2, coin.y + coin.height / 2);
            ctx.rotate(coin.rotation);
            ctx.globalAlpha = coin.opacity;
            ctx.drawImage(coin.image, -coin.width / 2, -coin.height / 2, coin.width, coin.height);
            ctx.restore();
        }

        function moveCoin() {
            coin.y -= coin.speedY;
            coin.opacity -= 0.02;
            coin.rotation += 0.1;
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.drawImage(ground.image, ground.x, ground.y, ground.width, ground.height);
            ctx.drawImage(box.image, box.x, box.y, box.width, box.height);
            ctx.drawImage(player.currentImage, player.x, player.y, player.width, player.height);

            controlPlayer();

            if (checkCollision(player, box)) {
                createCoin();
            }

            drawCoin();
            moveCoin();

            if (checkCollision()) {
                clearInterval(gameInterval);
                alert('게임 오버!');
                location.reload();
            }
        }

        function createCoin() {
            coin.x = box.x + box.width / 2;
            coin.y = box.y - 20;
            coin.opacity = 1;
            coin.rotation = 0;
        }

        function checkCollision(object1, object2) {
            if (
                object1.x < object2.x + object2.width &&
                object1.x + object1.width > object2.x &&
                object1.y < object2.y + object2.height &&
                object1.y + object1.height > object2.y
            ) {
                return true;
            }
            return false;
        }

        const gameInterval = setInterval(gameLoop, 1000 / 60);

        canvas.addEventListener('click', () => {
            if (player.canJump) {
                player.isJumping = true;
                player.currentImage = player.imageJump;
                player.canJump = false;
            }
        });
    </script>
</body>
</html>
